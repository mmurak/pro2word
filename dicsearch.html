<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
    <title>Word to Pronunciation Search (Am.E)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="red-kiwi-bird.png">
    <script src="./iDict.js"></script>
    <style>
    .ctrl{
        font-size: 150%;
        font-family: Times New Roman;
    }
    .outarea{
        font-size: 150%;
        font-family: Times New Roman;
        color: black;
    }
    #background {
        background-color: #F9EBEA;
    }
    </style>
</head>

<body id="background">
<div style="display:inline-block;"><strong>Word to Pronunciation Search (Am.E)</strong></div>
<div style="display:inline-block; float:right;">Powered by Carnegie Mellon University's <a href="https://github.com/cmusphinx/cmudict" target="_blank">CMUdict</a>.</div>
<br/>
<input type="text" id="inarea" class="ctrl" onfocus="this.select();" spellcheck="false" autocomplete="off">
<input type="button" class="ctrl" value="Clear" onclick="clearAreas();">
<div style="display:inline-block; float:right;">to <a href="index.html">P -> W</a></div>
<br/>
<input type="checkbox" id="startw" class="ctrl" checked onchange="search();">Start with
<input type="checkbox" id="endw" class="ctrl" onchange="search();">End with
<br/>
<textarea id="outarea" class="outarea" rows="20" cols="40" spellcheck="false" autocomplete="off" disabled></textarea>

<script>
const inarea = document.getElementById("inarea");
const outarea = document.getElementById("outarea");
const startwith = document.getElementById("startw");
const endwith = document.getElementById("endw");

const prefix = "^";
const suffix = "$";

let searchDict = {};
for (let [key, value] of Object.entries(iDict)) {
    value.forEach(elem => {
        if (elem in searchDict) {
            searchDict[elem] += "," + key;
        } else {
            searchDict[elem] = key;
        }
    });
}
let sortedKeys = Object.keys(searchDict).sort();

function search() {
    let target = inarea.value.toLowerCase();
    if (target == "") {
        outarea.value = "";
        inarea.style = "background-color: white;";
        return;
    }
    if (startwith.checked) target = prefix + target;
    if (endwith.checked) target = target + suffix;
    let re = new RegExp(target);
    outset = new Set();
    let candidateCount = 0;
    for (let key of sortedKeys) {
        if (re.test(key)) {
            if (candidateCount++ > 300) {
                outarea.value = "";
                inarea.style = "background-color: #E0F2F7;";
                return;
            }
            searchDict[key].split(/,/).forEach(pron => {
                    outset.add(key + "  /" + pron + "/");
            });
        }
    }
    if (candidateCount == 0) {
        inarea.style = "background-color: #F8E0E0;";
    } else {
        inarea.style = "background-color: #E0F8E0;";
    }
    outarea.value = "";
    Array.from(outset).sort().forEach(elem => {
        outarea.value += elem + "\n";
    });
}

function clearAreas() {
    inarea.value = "";
    outarea.value = "";
    inarea.style = "background-color: white;";
    inarea.focus();
}

inarea.focus();
inarea.addEventListener("input", evt => {
    search();
});
inarea.addEventListener("keydown", evt => {
    if (evt.key == "Escape") {
        clearAreas();
    }
});
</script>
</body>
</html>
