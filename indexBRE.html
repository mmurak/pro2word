<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
    <title>Pronunciation to Word Search (Br.E)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="deepgreen-kiwi-bird.png">
    <script src="./iDictBRE.js"></script>
    <style>
    table{
        table-layout: fixed;
    }
    .ipaCh{
        width: 100%;
        font-size: 150%;
        font-family: Times New Roman;
        paddiing: 0;
    }
    .csn{
        background-color: #afeeee;
    }
    .vwl{
        background-color: #ffc0cb;
    }
    .usr{
        background-color: #dcdcdc;
    }
    .cv{
        background-color: #f4a460;
    }
    .non{
        pointer-events: none;
    }
    .ctrl{
        font-size: 120%;
    }
    .outfield{
        font-size: 150%;
        font-family: Times New Roman;
        color: black;
    }
    label {
        cursor: pointer;
        display: block;
        float: center;
        text-align: center;
        padding: 5px;
        user-select: none;
    }
    input[type="checkbox"] {
        display: none;
    }
    input.checkboxer[type="checkbox"]:checked + .label {
        background-color: red;
        color: white;
    }
    input.checkboxer[type="checkbox"] + .label {
        background-color: #fcf3cf;
        color: black;
    }
    input[type="checkbox"]:checked + .label {
        background-color: #8080c0;
        color: white;
    }
    input[type="checkbox"] + .label {
        background-color: white;
        color: black;
    }
    .dlgb {
        border: 1px solid gray;
        padding: 20px;
        background-color: white;
        color: black;
        display: inline-block;
        position: absolute;
        top: 10px;
        left: 10px;
        width: auto; 
        height: auto;
        z-index: 5;
    }
    .cfctrl {
        width: 100%;
    }
    #displayfield{
        width: 100%;
        font-size: 150%;
        font-family: Times New Roman;
    }
    #keyboard{
        width: 100%;
    }
    #background {
        background-color: #EBF5FB;
    }
    @media screen and (max-width: 820px) {
        .ipaCh{
            width: 100%;
            font-size: 100%;
            font-family: Times New Roman;
        }
        .ctrl{
            font-size: 100%;
        }
        .outfield{
            font-size: 100%;
            font-family: Times New Roman;
        }
    }
    @media screen and (max-width: 550px) {
        .ipaCh{
            width: 100%;
            font-size: 70%;
            font-family: Times New Roman;
        }
        .ctrl{
            font-size: 70%;
        }
        .outfield{
            font-size: 100%;
            font-family: Times New Roman;
        }
    }
    </style>
</head>

<body id="background">
<div style="display:inline-block;"><strong>Pronunciation to Word Search (Br.E)</strong></div>
<div style="display:inline-block; float:right;">Powered by <a href="https://github.com/JoseLlarena/Britfone" target="_blank">Britfone</a>.</div>
<br/>
<div style="display:inline-block; float:right;">to <a href="dicsearchBRE.html">W -> P</a></div>
<br/>
<div style="display: flex; align-items: flex-start;align-items: stretch;">
<table>
<tr>
<td style="border: 1px #808080 solid;"><input type="checkbox" id="startw" class="ctrl" checked onchange="search();"><label class="label" for="startw">Start with</label></span></td>
<td style="border: 1px #808080 solid;"><input type="checkbox" id="endw" class="ctrl" onchange="search();"><label class="label" for="endw">End with</label></td>
</tr>
</table>
&nbsp;&nbsp;&nbsp;
<input type="button" class="ctrl" value="Backspace" onclick="backspace();"></input>
&nbsp;
<input type="button" class="ctrl" value="All Clear" onclick="clearField();"></input>
</div>
<input type="text" id="displayfield" class="ctrl" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></input>
<table id="keyboard" border="1">
<tr>
    <td><input type="button" class="ipaCh csn fl" value="p" onclick="pushed('p');"></td>
    <td><input type="button" class="ipaCh csn fl" value="b" onclick="pushed('b');"></td>
    <td><input type="button" class="ipaCh csn fl" value="t" onclick="pushed('t');"></td>
    <td><input type="button" class="ipaCh csn fl" value="d" onclick="pushed('d');"></td>
    <td><input type="button" class="ipaCh csn fl" value="k" onclick="pushed('k');"></td>
    <td><input type="button" class="ipaCh csn fl" value="ɡ" onclick="pushed('ɡ');"></td>
    <td><input type="button" class="ipaCh csn fl" value="m" onclick="pushed('m');"></td>
    <td><input type="button" class="ipaCh csn fl" value="n" onclick="pushed('n');"></td>
    <td><input type="button" class="ipaCh csn fl" value="ŋ" onclick="pushed('ŋ');"></td>
    <td><input type="button" class="ipaCh non fl" value="" onclick="pushed('');"></td>
    <td><input type="button" class="ipaCh csn fl" value="l" onclick="pushed('l');"></td>
    <td><input type="button" class="ipaCh csn fl" value="ɹ" onclick="pushed('ɹ');"></td>
</tr>
<tr>
    <td><input type="button" class="ipaCh csn fl" value="f" onclick="pushed('f');"></td>
    <td><input type="button" class="ipaCh csn fl" value="v" onclick="pushed('v');"></td>
    <td><input type="button" class="ipaCh csn fl" value="θ" onclick="pushed('θ');"></td>
    <td><input type="button" class="ipaCh csn fl" value="ð" onclick="pushed('ð');"></td>
    <td><input type="button" class="ipaCh csn fl" value="s" onclick="pushed('s');"></td>
    <td><input type="button" class="ipaCh csn fl" value="z" onclick="pushed('z');"></td>
    <td><input type="button" class="ipaCh csn fl" value="ʃ" onclick="pushed('ʃ');"></td>
    <td><input type="button" class="ipaCh csn fl" value="ʒ" onclick="pushed('ʒ');"></td>
    <td><input type="button" class="ipaCh csn fl" value="h" onclick="pushed('h');"></td>
    <td><input type="button" class="ipaCh non fl" value="" onclick="pushed('');"></td>
    <td><input type="button" class="ipaCh csn fl" value="ts" onclick="pushed('ts');"></td>
    <td><input type="button" class="ipaCh csn fl" value="dz" onclick="pushed('dz');"></td>
</tr>
<tr>
    <td><input type="button" class="ipaCh vwl fl" value="a" onclick="pushed('a');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="e" onclick="pushed('e');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="i" onclick="pushed('i');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ɔ" onclick="pushed('ɔ');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="u" onclick="pushed('u');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ɐ" onclick="pushed('ɐ');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ə" onclick="pushed('ə');"></td>
    <td><input type="button" class="ipaCh non fl" value="" onclick="pushed('');"></td>
    <td><input type="button" class="ipaCh csn fl" value="j" onclick="pushed('j');"></td>
    <td><input type="button" class="ipaCh non fl" value="" onclick="pushed('');"></td>
    <td><input type="button" class="ipaCh csn fl" value="tʃ" onclick="pushed('tʃ');"></td>
    <td><input type="button" class="ipaCh csn fl" value="dʒ" onclick="pushed('dʒ');"></td>
</tr>
<tr>
    <td><input type="button" class="ipaCh vwl fl" value="æ" onclick="pushed('æ');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ɛ" onclick="pushed('ɛ');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ɪ" onclick="pushed('ɪ');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ɒ" onclick="pushed('ɒ');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ʊ" onclick="pushed('ʊ');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ɑ" onclick="pushed('ɑ');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ɜː" onclick="pushed('ɜː');"></td>
    <td><input type="button" class="ipaCh vwl fl" value="ː" onclick="pushed('ː');"></td>
    <td><input type="button" class="ipaCh csn fl" value="w" onclick="pushed('w');"></td>
    <td><input type="button" class="ipaCh non fl" value="" onclick="pushed('');"></td>
    <td><input type="button" class="ipaCh non fl" value="" onclick="pushed('');"></td>
    <td><input type="button" class="ipaCh non fl" value="" onclick="pushed('');"></td>
</tr>
<tr>
    <td><input type="button" class="ipaCh cv fl" value="C" onclick="pushed('C');"></td>
    <td><input type="button" class="ipaCh cv fl" value="V" onclick="pushed('V');"></td>
    <td><input type="button" id="f1" class="ipaCh usr fl" value="-1-" onclick="funcCh(1);"></td>
    <td><input type="button" id="f2" class="ipaCh usr fl" value="-2-" onclick="funcCh(2);"></td>
    <td><input type="button" id="f3" class="ipaCh usr fl" value="-3-" onclick="funcCh(3);"></td>
    <td><input type="button" id="f4" class="ipaCh usr fl" value="-4-" onclick="funcCh(4);"></td>
    <td><input type="button" id="f5" class="ipaCh usr fl" value="-5-" onclick="funcCh(5);"></td>
    <td><input type="button" id="f6" class="ipaCh usr fl" value="-6-" onclick="funcCh(6);"></td>
    <td><input type="button" id="f7" class="ipaCh usr fl" value="-7-" onclick="funcCh(7);"></td>
    <td><input type="button" class="ipaCh non fl" value="" onclick="pushed('');"></td>
    <td><input type="button" class="ipaCh non fl" value="" onclick="pushed('');"></td>
    <td><input type="checkbox" class="ipaCh checkboxer fl" id="recBtn" value="+"><label class="label" for="recBtn">Reg</label></td>
</tr>
</table>
<textarea id="outarea" class="outfield" rows="20" cols="40" spellcheck="false" autocomplete="off" disabled></textarea>


<div id="entryDialog" class="dlgb" style="visibility: hidden;">

<input type="button" id="configBS" value="Backspace" onclick="cfbackspace();">
<input type="text" id="configfield" class="cfctrl" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></input>

<table id="configKeyboard" border="1">
<tr>
    <td><input type="button" class="ipaCh csn" value="p" onclick="picked('p');"></td>
    <td><input type="button" class="ipaCh csn" value="b" onclick="picked('b');"></td>
    <td><input type="button" class="ipaCh csn" value="t" onclick="picked('t');"></td>
    <td><input type="button" class="ipaCh csn" value="d" onclick="picked('d');"></td>
    <td><input type="button" class="ipaCh csn" value="k" onclick="picked('k');"></td>
    <td><input type="button" class="ipaCh csn" value="ɡ" onclick="picked('ɡ');"></td>
    <td><input type="button" class="ipaCh csn" value="m" onclick="picked('m');"></td>
    <td><input type="button" class="ipaCh csn" value="n" onclick="picked('n');"></td>
    <td><input type="button" class="ipaCh csn" value="ŋ" onclick="picked('ŋ');"></td>
    <td><input type="button" class="ipaCh non" value="" onclick="picked('');"></td>
    <td><input type="button" class="ipaCh csn" value="l" onclick="picked('l');"></td>
    <td><input type="button" class="ipaCh csn" value="ɹ" onclick="picked('ɹ');"></td>
</tr>
<tr>
    <td><input type="button" class="ipaCh csn" value="f" onclick="picked('f');"></td>
    <td><input type="button" class="ipaCh csn" value="v" onclick="picked('v');"></td>
    <td><input type="button" class="ipaCh csn" value="θ" onclick="picked('θ');"></td>
    <td><input type="button" class="ipaCh csn" value="ð" onclick="picked('ð');"></td>
    <td><input type="button" class="ipaCh csn" value="s" onclick="picked('s');"></td>
    <td><input type="button" class="ipaCh csn" value="z" onclick="picked('z');"></td>
    <td><input type="button" class="ipaCh csn" value="ʃ" onclick="picked('ʃ');"></td>
    <td><input type="button" class="ipaCh csn" value="ʒ" onclick="picked('ʒ');"></td>
    <td><input type="button" class="ipaCh csn" value="h" onclick="picked('h');"></td>
    <td><input type="button" class="ipaCh non" value="" onclick="picked('');"></td>
    <td><input type="button" class="ipaCh csn" value="ts" onclick="picked('ts');"></td>
    <td><input type="button" class="ipaCh csn" value="dz" onclick="picked('dz');"></td>
</tr>
<tr>
    <td><input type="button" class="ipaCh vwl" value="a" onclick="picked('a');"></td>
    <td><input type="button" class="ipaCh vwl" value="e" onclick="picked('e');"></td>
    <td><input type="button" class="ipaCh vwl" value="i" onclick="picked('i');"></td>
    <td><input type="button" class="ipaCh vwl" value="ɔ" onclick="picked('ɔ');"></td>
    <td><input type="button" class="ipaCh vwl" value="u" onclick="picked('u');"></td>
    <td><input type="button" class="ipaCh vwl" value="ɐ" onclick="picked('ɐ');"></td>
    <td><input type="button" class="ipaCh vwl" value="ə" onclick="picked('ə');"></td>
    <td><input type="button" class="ipaCh non" value="" onclick="picked('');"></td>
    <td><input type="button" class="ipaCh csn" value="j" onclick="picked('j');"></td>
    <td><input type="button" class="ipaCh non" value="" onclick="picked('');"></td>
    <td><input type="button" class="ipaCh csn" value="tʃ" onclick="picked('tʃ');"></td>
    <td><input type="button" class="ipaCh csn" value="dʒ" onclick="picked('dʒ');"></td>
</tr>
<tr>
    <td><input type="button" class="ipaCh vwl" value="æ" onclick="picked('æ');"></td>
    <td><input type="button" class="ipaCh vwl" value="ɛ" onclick="picked('ɛ');"></td>
    <td><input type="button" class="ipaCh vwl" value="ɪ" onclick="picked('ɪ');"></td>
    <td><input type="button" class="ipaCh vwl" value="ɒ" onclick="picked('ɒ');"></td>
    <td><input type="button" class="ipaCh vwl" value="ʊ" onclick="picked('ʊ');"></td>
    <td><input type="button" class="ipaCh vwl" value="ɑ" onclick="picked('ɑ');"></td>
    <td><input type="button" class="ipaCh vwl" value="ɜː" onclick="picked('ɜː');"></td>
    <td><input type="button" class="ipaCh vwl" value="ː" onclick="picked('ː');"></td>
    <td><input type="button" class="ipaCh csn" value="w" onclick="picked('w');"></td>
    <td><input type="button" class="ipaCh non" value="" onclick="picked('');"></td>
    <td><input type="button" class="ipaCh non" value="" onclick="picked('');"></td>
    <td><input type="button" class="ipaCh non" value="" onclick="picked('');"></td>
</tr>
</table>
<input type="button" class="btn" value="Cancel" onclick="closeTAdialog();">
<input type="button" class="btn" value="OK" onclick="processTAdialog();">
</div>

<script>
class GlobalManager {
    constructor() {
        this.outarea = document.getElementById("outarea");
        this.startwith = document.getElementById("startw");
        this.endwith = document.getElementById("endw");
        this.displayfield = document.getElementById("displayfield");
        this.recBtn = document.getElementById("recBtn");
        this.dialog = document.getElementById("entryDialog");
        this.configfield = document.getElementById("configfield");
        this.presetArray = [
            "lɹ",
            "stθ",
            "zdð",
            "",
            "",
            "",
            "",
        ];
        this.presetPointer;
        this.fkeyPtr = [];
        for (let i = 1; i <= this.presetArray.length; i++) {
            let fk = document.getElementById("f" + i);
            this.fkeyPtr.push(fk);
            if (this.presetArray[i-1] == "") {
                fk.value = "-" + i + "-";
            } else {
                fk.value = "[" + this.presetArray[i-1] + "]";
            }
        }
    }
}

const G = new GlobalManager();

const vowels = "[ɛɒɪɐəæɜːeauɔɑiʊ]+";
const consonants = "[pktmvrwθfʃʒdzŋsjðlnɡbh]";
const asic = "[aæɐɑɔəɜː]+";
const esic = "[æɐeɛɪɚɜː]+";
const isic = "[iɪjə]+";
const osic = "[ɐɜːɔoʊə]+";
const usic = "[uʊəw]+";

const lrobfuscator = "[lr]";
const tTobfuscator = "[tθs]";
const dDobfuscator = "[dðz]";
const bVobfuscator = "[bv]";
const nNobfuscator = "[mnŋ]";

const prefix = "^";
const suffix = "$";

searchDict = {};
for (let [key, value] of Object.entries(iDict)) {
    let newkey = key.replaceAll("\u{0300}", "");
    newkey = newkey.replaceAll("\u{0301}", "");
    searchDict[newkey] = key;
}

function convert(text) {
    text = text.replaceAll("V", vowels);
    text = text.replaceAll("C", consonants);
    text = text.replaceAll("L", lrobfuscator);
    text = text.replaceAll("D", dDobfuscator);
    text = text.replaceAll("T", tTobfuscator);
    text = text.replaceAll("B", bVobfuscator);
    text = text.replaceAll("M", nNobfuscator);
    text = text.replaceAll("A", asic);
    text = text.replaceAll("I", isic);
    text = text.replaceAll("U", usic);
    text = text.replaceAll("E", esic);
    text = text.replaceAll("O", osic);
    if (G.startwith.checked) {
        text = prefix + text;
    }
    if (G.endwith.checked) {
        text = text + suffix;
    }
    return text;
}

function search() {
    G.outarea.value = "";
    let target = convert(G.displayfield.value);
    let re = null;
    try {
        re = new RegExp(target);
    } catch(error) {
        return;
    }
    outset = new Set();
    let candidateCount = 0;
    for (let [key, value] of Object.entries(searchDict)) {
        if (re.test(key)) {
            if (candidateCount++ > 300) {
                if (G.displayfield.value != "") {
                    G.displayfield.style = "background-color: #E0F2F7;";
                } else {
                    G.displayfield.style = "background-color: white;";
                }
                return;
            }
            iDict[searchDict[key]].forEach(e => {
                outset.add(e + "  /" + searchDict[key] + "/");
            });
        }
    }
    outarea.value = "";
    Array.from(outset).sort().forEach(elem => {
        outarea.value += elem + "\n";
    });
    if (Array.from(outset).length == 0) {
        G.displayfield.style = "background-color: #F8E0E0";
    } else {
        G.displayfield.style = "background-color: #E0F8E0;";
    }
}

function pushed(ipa) {
    const st = G.displayfield.selectionStart;
    const ed = G.displayfield.selectionEnd;
    if (st != ed) {
        _eraseRegion();
    }
    G.displayfield.value = G.displayfield.value.substring(0, st) + ipa + G.displayfield.value.substring(st);
    G.displayfield.selectionStart = G.displayfield.selectionEnd = st + ipa.length;
    search();
    G.displayfield.focus();
}

function funcCh(val) {
    G.presetPointer = val - 1;
    if (G.recBtn.checked) {
        openTAdialog();
        G.recBtn.checked = false;
    } else {
        const str = G.presetArray[G.presetPointer];
        if (str == "") return;
        pushed("[" + str + "]");
    }
}

function _eraseRegion() {
    const st = Math.min(G.displayfield.selectionStart, G.displayfield.selectionEnd);
    const ed = Math.max(G.displayfield.selectionStart, G.displayfield.selectionEnd);
    G.displayfield.value = G.displayfield.value.substring(0, st) + G.displayfield.value.substring(ed);
    G.displayfield.selectionStart = G.displayfield.selectionEnd = st;
}

function backspace() {
    if (Math.abs(G.displayfield.selectionStart - G.displayfield.selectionEnd) == 0) {
        const pt = G.displayfield.selectionStart;
        G.displayfield.value = G.displayfield.value.substring(0, G.displayfield.selectionStart - 1) + G.displayfield.value.substring(G.displayfield.selectionStart);
        G.displayfield.selectionStart = G.displayfield.selectionEnd = pt - 1;
    } else {
        _eraseRegion();
    }
    search();
    G.displayfield.focus();
}
function clearField() {
    G.displayfield.value = "";
    G.displayfield.style = "background-color: white;";
    G.outarea.value = "";
    G.displayfield.focus();
}

G.displayfield.addEventListener("keyup", (evt) => {
    search();
});


function openTAdialog() {
    flController(true);
    G.configfield.value = G.presetArray[G.presetPointer];
    G.dialog.style.visibility = "visible";
    G.configfield.focus();
}

function processTAdialog() {
    G.presetArray[G.presetPointer] = G.configfield.value;
    G.fkeyPtr[G.presetPointer].value = "[" + G.configfield.value + "]";
    closeTAdialog();
}

function closeTAdialog() {
    G.dialog.style.visibility = "hidden";
    flController(false);
}


function picked(ipa) {
    const st = G.configfield.selectionStart;
    const ed = G.configfield.selectionEnd;
    if (st != ed) {
        _eraseConfigRegion();
    }
    G.configfield.value = G.configfield.value.substring(0, st) + ipa + G.configfield.value.substring(st);
    G.configfield.selectionStart = G.configfield.selectionEnd = st + ipa.length;
    G.configfield.focus();
}

function _eraseConfigRegion() {
    const st = Math.min(G.configfield.selectionStart, G.configfield.selectionEnd);
    const ed = Math.max(G.configfield.selectionStart, G.configfield.selectionEnd);
    G.configfield.value = G.configfield.value.substring(0, st) + G.configfield.value.substring(ed);
    G.configfield.selectionStart = G.configfield.selectionEnd = st;
}

function cfbackspace() {
    if (Math.abs(G.configfield.selectionStart - G.configfield.selectionEnd) == 0) {
        const pt = G.configfield.selectionStart;
        G.configfield.value = G.configfield.value.substring(0, G.configfield.selectionStart - 1) + G.configfield.value.substring(G.configfield.selectionStart);
        G.configfield.selectionStart = G.configfield.selectionEnd = pt - 1;
    } else {
        _eraseConfigRegion();
    }
    G.configfield.focus();
}

function flController(flag) {
    const elemArray = document.getElementsByClassName("fl");
    for (elem of elemArray) {
        elem.disabled = flag;
    }
}

G.displayfield.focus();

</script>
</body>
</html>
